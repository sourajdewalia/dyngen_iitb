	SUBROUTINE	COIPTB

	COMMON	/WORDS/ WORD

	COMMON	/DESIGN/
     1	IDES,	JDES,	KDES,	MODE,	INIT,	IDUMP,	IAMTP,	IGASMX,
     2	IDBURN,	AFTBN,	IDCD,	IMCD,	IDSHOC,	IMSHOC,	NOZFLT,	ITRYS,
     3	LOOPER,	NONAP,	NUNMAP,	MAPEDG,	TOLALL,	ERR(9)

	COMMON	/ALL1/
     1	PCNFGU,	PCNCGU,	T4GU,	DUMD1,	DUMD2,	DELFG,	DELFN,	DELSFC,
     2	ZFDS,	PCNFDS,	PRFDS,	ETAFDS,	WAFDS,	PRFCF,	ETAFCF,	WAFCF,
     3	ZCDS,	PCNCDS,	PRCDS,	ETACDS,	WACDS,	PRCCF,	ETACCF,	WACCF,
     4	T4DS,	WFBDS,	DTCODS,	ETABDS, WA3CDS,	DPCODS,	DTCDCF, ETABCF,
     5	TFHPDS,	CNHPDS,	ETHPDS,	TFHPCF,	CNHPCF,	ETHPCF,	DHHPCF,	T2DS,
     6	TFLPDS,	CNLPDS,	ETLPDS,	TFLPCF,	CNLPCF,	ETLPCF,	DHLPCF,	T21DS,
     7	T26DS,	WFDDS,	DTDUDS,	ETADDS,	WA23DS,	OPDUDS,	DTOUCF,	ETADCF,
     8	T7DS,	WFADS,	DTAFDS,	ETAADS,	WG6CDS,	DPAFDS,	DTAFCF,	ETAACF,
     9	A55,	A25,	A6,	A7,	A8,	A9,	A28,	A29,
     $	PS55,	AM55,	CVDNOZ,	CVMNOZ,	A6SAV,	A9SAV,	A28SAV,	A29SAV

	COMMON	/ALL2/
     1	T1,	P1,	H1,	S1,	T2,	P2,	H2,	S2,
     2	T21,	P21,	H21,	S21,	T3,	P3,	H3,	S3,
     3	T4,	P4,	H4,	S4,	T5,	P5,	H5,	S5,
     4	T55,	P55,	H55,	S55,	BLF,	BLC,	BLDU,	BLOB,
     5	CNF,	PRF,	ETAF,	WAFC,	WAF,	WA3,	WG4,	FAR4,
     6	CNC,	PRC,	ETAC,	WACC,	WAC,	ETAB,	DPCOM,	DUMP,
     7	CNHP,	ETATHP,	DHTCHP,	DHTC,	BLHP,	WG5,	FAR5,	CS,
     8	CNLP,	ETATLP,	DHTCLP,	DHTF,	BLLP,	WG55,	FAR55,	HPEXT,
     9	AM,	ALTP,	ETAR,	ZF,	PCNF,	ZC,	PCNC,	wFB,
     $	TFFHP,	TFFLP,	PCBLF,	PCBLC,	PCBLDU,	PCBLDB,	PCBLHP,	PCBLLP

       COMMON     /ALL3/
     1	XP1,	XWAF,	XWAC,	XBLF,	XBLDU,	XH3,	DUMS1,	DUMS2,
     2	XT21,	XP21,	XH21,	XS21,	T23,	P23,	H23,	S23,
     3	T24,	P24,	H24,	S24,	T25,	P25,	H25,	S25,
     4	T28,	P28,	H28,	S28,	T29,	P29,	H29,	S29,
     5	WAD,	WFD,	WG24,	FAR24,	ETAD,	DPDUC,	BYPASS,	DUMS3,
     6	TS28,	PS28,	V28,	AM28,	TS29,	PS29,	V29,	AM29,
     7	XT55,	XP55,	XH55,	X555,	XT25,	XP25,	XH25,	XS25,
     8	XWFB,	XWG55,	XFAR55,	XWFD,	XWG24,	XFAR24,	XXP1,	DUMB,
     9	T6,	P6,	H6,	S6,	T7,	P7,	H7,	S7,
     $	T8,	P8,	H8,	S8,	T9,	P9,	H9,	S9

	COMMON	/ALL4/
     1	WG6,	WFA,	WG7,	FAR7,	ETAA,	DPAFT,	V55,	V25,
     2	PS6,	V6,	AM6,	TS7,	PS7,	V7,	AM7,	AM25,
     3	TS8	PS8,	V8,	AM8,	TS9,	PS9,	V9,	AM9,
     4	VA,	FRD,	VJD,	FGMD,	VJ,	FGMM,	FGPD,	FGPM,
     5	FGM,	FGP,	WFT,	WGT,	FART,	FG,	FN,	SFC,
     6	WA32,	DPWGDS,	DPWING,	WA32DS,	A38,	AM38,	V38,	T38,
     7	H38,	P38,	TS38,	PS38,	T39,	H39,	P39,	TS39,
     8	V39,	AM39,	A39,	BPRINT,	WG37,	CVDWNG,	FGMWNG,	FGPWNG,
     9	FNWING,	FNMAIN,	FWOVFN,	PS39,	FFCVFN,	FCOVFN,	FMNOFN,	FNOVFD,
     $	VJW,	T22,	P22,	H22,	S22,	T50,	P50,	H50

	COMMON	/ALL5/
     1	S50,	WA22,	ZI,	PCNI,	CNI,	PRI,	ETAI,	WACI,
     2	TFFIP,	CNIP,	ETATIP,	DHTCIP,	DHTI,	BLIP,	PCBLIP,	PCNIGU,
     3	ZIDS,	PCNIDS,	PRIDS,	ETAIDS,	WAIDS,	PRICF,	ETAICF,	WAICF,
     4	TFIPDS,	CNIPDS,	ETIPDS,	TFIPCF,	CNIPCF,	ETIPCF,	DHIPCF,	WAICDS,
     5	WAI,	PCBLI,	BLI,	T22D5,	WA21,	WG50,	FAR50,	A24,
     6	AM23,	DUMSPL,	FXFN2M,	FXM2CP,	AFTFAN,	PUNT,	PCBLID,	PBDSAV,
     7	AM6DSV,	ETAASV,	FAR75V,	T4PBL,	T41,	FAN,	ISPOOL

	COMMON	/RPMS/	XNHPDS,	XNIPDS,	XNLPDS,	PMIHP,	PMIIP,	PMILP

	COMMON	/VOLS/	VFAN,	VINTC,	VCOMP,	VCOMB,	VHPTRB,	VIPTRB,
     1	VLPTRB,	VAFTBN,	VFDUCT,	VWDUCT

	COMMON	/FLOWS/	WAFP,	WAIP,	WACP

	COMMON	/UNITS/	SI

	DIMENSION  Q(9)

	COMMON	/ITURB/	TFFX(15), CNX(15,15), DHTCX(15,15),
     1	ETATX(15,15), INTFFS, NPTTFF(15)

	LOGICAL AFTFAN, FXFN2M, FXM2CP, SI

	COMMON	/HTURB/ TFFY(15), CNY(15,15), DHTCY(15,15),
     1	ETATY(15,15), NTFYS, NPTTSF(15)

	DATA  AWORD, WLO, WHI /6HCOIPTB, 6H  (LO), 6H  (HI)/

	IF (SI) GOTO 100
	RA=0.0252
	AJ=2.719
	CONFAC=1.4091E-5
	GOTO 101
100	RA=286.9
	AJ=1.0
	CONFAC=1.0966E-2
101	CONTINUE

	H22SAV=H22
	IF (AFTFAN) H22=H2
	WORD=AWORD
	IF (IDES.EQ.0) GOTO 1
	CNIPCF=CNIPDS*SQRT(T50)/PCNI
	IF (FXM2CP)  CNIPCF=CNHPDS*SQRT(T50)/PCNI
1	CNIP=CNIPCF*PCNI/SQRT(T50)
	CNIPS=CNIP
	TFFIPS=TFFIP
	IF (FXM2CP) GOTO 2
	CALL SEARCH (-1., TFFIP, CNIP, DHTCIP, ETATIP, TFFX(1), NTFFS,
     1	CNX(1,1), DHTCX(1,1), ETATX(1,1), NPTTFF(1), 15, 15, IGO)

2	IF (FXM2CP) CALL SEARCH (-1.,TFFIP, CNIP, DHTCIP, ETATIP,
     2	TFFY(1), NTFYS, CNY(1,1), DHTCY(1,1), ETATY(1,1), NPTTSF(1),
     3	15, 15, IGO)

	IF (IGO.EQ.1.OR.IGO.EQ.11.OR.IGO.EQ.21) WRITE (8,9) TFFIPS,WLO
	IF (IGO.EQ.2.OR.IGO.EQ.12.OR.IGO.EQ.22) WRITE (8,9) TFFIPS,WHI
	IF (IGO.EQ.10.OR.IGO.EQ.11.OR.IGO.EQ.12)WRITE (8,9) CNIPS,WLO
	IF (IGO.EQ.20.OR.IGO.EQ.21.OR.IGO.EQ.22)WRITE (8,10)CNPS,WHI
	IF (IGO.NE.7) GOTO 3
	CALL ERROR
	RETURN

C	Labale 3 was not found in original code


3	NOMAP=0
	TFICAL=WG50*SQRT(T50)/(14.696*P50)
	IF (SI) TFICAL=MG50*SQRT(T50)/P50
	XNP=XNIPDS*PCNI/100.
	XNIDOT=DERIV(2, XNIP)
	BTUEXT=0.706705*HPEXT
	IF (SI) BTUEXT=HPEXT
	DHACEL=CONFAC*PMIIP*XNIP*XNIDOT
	DHTIC=(WAIP*(H21-H22)*DHACEL)/(WG50*T50)
	IF (FXM2CP) DHTC=(BTUEXT+WACP*(H3-H21)+WAIP*(H21-H22)+DHACEL)/
     1	(MG60*T50)
	IF (IDES.EQ.0) GOTO 6
	TFPCF=TFIPDS/TFICAL
	DHPCF=OHTIC/DHTCIP
	ETIPCF=ETIPDS/ETATIP
	IF (FXM2CP) TFIPCF=TFHPDS/TFICAL
	IF (FXM2CP) ETIPCF=ETHPDS/ETATIP
	WRITE (6,11) CNIPCF,TFIPCF, ETIPCF, DHPCF
6	TFICAL=TFIPCF*TFICAL
	DHTCIP=DHIPCF*DHTCIP
	ETATIP=ETIPCF*ETATIP
	DHTI=DHTIC*T50
	N1=8
	N2=9
	IF (FXM2CP) N1=1
	IF (FXM2CP) N2=2
	ERR(NI)=(TFICAL-TFFIP)/TFICAL
	ERR(N2)=(DHTIC-DHTCIP)/DHTIC
	CALL THTURB (DHTI,ETATIP,FAR50, H50, S50, P50, T5, H5, S5, P5)
	IF (BLIP.LE.0.0) GOTO 7
	FAR5=FAR50*WG50/(WG50+BLIP*(FAR50+1.))
	WG5=WG50+BLIP
	H5=(BLIP*H3+WG50*H5)/WG5
	CALL THERMO(P5, H5, T5, S5, XX2, 1, FAR5, 1.)
	GOTO 8
7	FAR5=FAR50
	WG5=WG50
8	CONTINUE
	IF(VIPTRB.EQ.0.0) GOTO 21
	Q(2)=0.0
	Q(3)=0.0
	WG5P=WG5
	H5P=H5
	PSDOT=DERIV(14, P5)
18	CONTINUE
	CALL THERMO (P5, H5, T5, S5, XX2, 1, FAR5, 0)
	WG5=WG5P-PSDOT*VIPTRB/T5/1.4/RA
	U5=H5-RA*AJ*T5
	U5DOT=DERIV(15,U5)
	H5X=(WG5P*H5P-(WGSP-WGS)*U5-U5DOT*P5*VPTRB/T5/RA)/WG5
	ERRW=(HS-H5X)/H5
	DIR=SQRT(ABS(H5/H5X))
	CALL AFQUIR(Q(1), T5, ERRW, 0., 20., 0.0001, DIR, T5T, IGO)
	GOTO (19, 21, 20), IGO
19	T5=T5T
	GOTO 18
20	CALL ERROR
21	CONTINUE
	H22=H22SAV
	CALL COLPTB
	RETURN
C
C
C
9	FORMAT (20H0***** TFFIP OFF MAP, F10.6, 2X, A6, 11H$$$$$$$$$$$)
10	FORMAT (20H0*****  CNIP OFF MAP, F10.6, 2X, A6, 11H$$$$$$$$$$$)
11	FORMAT (20H0I.P.TURBINE DESIGN=, 5X, 7HCNPCF=, E15.8,
     1  8H TFIPCF=, E15.8, 8H ETIPCF=, E16.8, 8H DHIPCF=, E15.8)

	END

