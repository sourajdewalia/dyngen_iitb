	SUBROUTINE  CONDIV (TI, HI, PI, SI, FAR, WG, PA, IDES,
     1	AT, AO, PIR, TT, HT, PT, S, T, TO, HO, PO, SO, TST, TSO,
     2	PST, PSO, VT, VO, AMT, AMO, ICON)
C
C	Performs nozzle calculations for a convergent-divergent
C	(C-D) nozzle
C
C	ICON-1	SUBSONIC, COMPARE PIR NITH PI
C	ICON-2	SONIC, SHOCK INSIDE NOZZLE, COMPARE PIR WITH PI
C       ICON-3  SONIC, SHOCK OUTSIDE NOZZLE, COMPARE PIR WITH PI
C       ICON-4	ERROR

	COMMON	/UNITS/	ZI
	LOGICAL	ZI

	DIMENSION	Q(9)
	Q(2)=0.
	Q(3)=0
	IF (ZI) GOTO 100
	AJ=778.26
	CAPSF=2116.7170
	G=32.174069
	GOTO 101
100	AJ=1.0
	CAPSF=101325.0
	G=1.0
101	CONTINUE

	CALL PROCOM (FAR, TI, XX1, XX2, XX3, XX4, PHII, XX6)
C	SONIC CALCULATIONS
	J=0.
	TSS=0.833*TI
1	J=J+1
	CALL PROCOM (FAR,TSS, CSS, AKICP, REXS, PHISS, HSS)
	HSCAL=HI-CSS**2/(2.*G*AJ)
	DELHS=HSCAL-HSS
	IF (ABS(DELHS)-0.000*HSCAL) 4,4,2
2	TSS=TSS+DELHS/CP
	IF (J-15) 1, 1, 3
3	ICON=4
	RETURN
4	IF (IDES) 11, 11, 5
C	SONIC DESIGN. CALCULATE AT
5	VT=CSS
	TST=TSS
	PST=PI*(TST/TI)**(AK/(AK-1.))
	RHO=CAPSF*PST/(AJ*REXS*TST)
	AT=WG/(RHO*VT)
	AMT=1.0
C	IOEAL EXPANSION DESIGN, CALCULATE AO
	PSO=PA
	J=0
	TSO=TI*(PSO/PI)**0.286
6	J=J+1
	CALL PROCOM (FAR,TSO, CSO, AK, CP, REX, PHISO, HSO)
	PHICAL=PHII-REX*ALOG(PI/PSO)
	DELPHI=PHECAL-PHISO
	IF (ABS(DELPHI)-0.0001*PHICAL) 8, 8, 7
7	TSO=TSO*EXP(4.*DELPHI)
	IF (J-15) 6, 6, 3
8	VO=SQRT(2.*G*AJ*(HI-HSO))
	AMO=VO/CSO
	AO=(AT/AMO)*(2.*(1.+(AK-1.)*AMO**2/2.)/
     1	(AK+1.))**((AK+1.)/(2.*(AK-1.)))
	PIR=PI
	ICON=3
9	TO=TI
	HO=HI
	PO=PI
	SO=SI
10	TT=TI
	HT=HI
	PT=PI
	ST=SI
	RETURN
C	ASSUME SONIC THROAT AND ISENTROPIC EXPANSION TO AO
11	VT=CSS
	AMT=1.0
	ST=TSS
	RHO=WG/(AT*VT)
	PST=RHO*AJ*REXS*TST/CAPSF
	PIR=PST*(TI/TST)**(AK/(AK-1.))
	IF (PST-PA) 12, 27, 27
12	TSO=0.95**TI
	MAM=0
13	CALL PROCOM (FAR, TSO, CSO, AK, CP, REX, PHISO, HSO)
	AMO=SQRT(2.*((TI/TSO)-1.0)/(AK-1.))
	AOCAL=(AT/AMO)*(2.*(1.+(AK-1.)*AMO**2/2.)/
     1	(AK+1.))**((AK+1.)/(2.*(AK-1.)))
	EA=(AO-AOCAL)/AO
	DIR=SQRT(AO/AOCAL)
	CALL AFQUIR (Q(1), TSO, EA, 0., 100., 0.0001, DIR, TSOT, JCON)
	GOTO (14,18,3), JCON
14	TSO=TSOT
	IF (TSO-TI) 15, 13, 16
15	TSC=2.*T1/(AK+1.)
	IF (TSO.GT.TSC) GOTO 17
16	TSO=0.98*TI
	GOTO 13
17	IF (Q(2).LT.30.0.OR.AMO.LT.0.95.OR.MAM.EQ.1) GOTO 13
	TSo=2.*TI/(2.+0.98*(AK-1.))
	MAM=I
	GOTO 13
18	PSO=PIR*(TSO/TI)**(AK/(AK-1.))
	IF (PSO-PA) 20, 19, 27
C ***   CRITICAL FLOW, ISENTROPIC EXPAMSION TO PA
19	VO=AMO*CSO
	ICON=1
	GOTO 9
C ***	SUBSONIC FLOW
20	PSO=PA
	Q(2)=0.
	Q(3)=0.
	J=0
	TSO=0.833*TI
21	J=J+1
	CALL PROCOM (FAR, TSO, CSO, AK, CP, REX, PHISO, HSO)
	RHO=CAPSF*PSO/(AJ*REX*TSO)
	VO=WG/(RHO*AO)
	HSCAL=HI-VO**2/(2.*G*AJ)
	DELHS=HSCAL-HSO
	IF (ABS(DELHS)-0.0005*HSCAL) 23, 23, 22
22	TSO=TSO+DELHS/CP
	IF (J-15) 21, 21, 3
23	AMO=VO/CSO
	PIR=PSO*(TI/TSO)**(AK/(AK-1.))
	TST=TSO
24	CALL PROCON (FAR, TST, CST, AK, GP, REX, PHIST, HST)
	PST=PIR*(TST/TI)**(AK/(AK-1.))
	RHO=PST*CAPSF/(AJ*REX*TST)
	VT=WG/(RHO*AT)
	HSCAL=Hi-VT**2/(2.*G*AJ)
	EH=(HSCAL-HST)/HSCAL
 	DIR=1.+(HSCAL-HST)/(CP*TST)
	CALL AFQUIR (Q(1), TST, EH,0., 20., 0.0005 ,DIR, TSTT, JCON)
	GOTO (25, 26, 3), JCON
25	TST=TSTT
	GOTO 26
26	AMT=VT/CST
	ICON=1
	GOTO 9
C ***	SUPERCRITICAL FLO, ISENTROPIC EXPANSION TO PA
27	PSO=PA
	J=0
	TSO=TI*(PSO/PR)**0.286
28	J=J+1
	CALL PROCOM (FAR, TSO, CSO, AK, CP, REX, PHISO, HSO)
	PHICAL=PHII-REX*ALOG(PIR/PSO)
	DELPHI=PHICAL-PHISO
	IF (ABS(DELPHI)-0.0001*PHICAL) 30, 30, 2
29	TSO=TSO*EXP(4.*DELPHI)
	IF (J-15) 28, 26, 3
30	TSO= SQRT(2.*G*AJ*(HI-HSO))
	AMO=VO/CSO
	AOID=(AT/AMO)*(2.*(1.+(AK-1.)*AMO**2/2.)/
     1	(AK+1.))**((AK+1.)/(2.*(AK-1.)))
	ICON=3
	N=O
	IF (AO-AOID) 31, 9, 32
C ***	SUPERCRT|CAL FLOW, ISENTROPIC EXPANSION TO AO
31	N=1
32	TSO=0.833*T1
	J=0
33	J=J+1
	CALL PROCOM (FAR, TSO, CSO, AK, CP, REX, PHISO, HSO)
	AMO=SQRT(2.*((TI/TSO)-1.)/(AK-1.))
	AOCAL=(AT/AMO)*(2.*(1.+(AK-1.)*AMO**2/2.)/
     1	(AK+1.))**((AK+1.)/(2.*(AK-1.)))
	DELA=AO-AOCAL
	IF (ABS(DELA)-0.0001*AO) 35, 35, 36
34	TSO=TSO*SQRT(AOCAL/AO)
	IF (J-50) 33, 33, 3
35	IF (N) 37, 37, 36
C ***	UNDEREXPANDEO, SHOCK OUTSIDE NOZZLE
36	PSO=PIR*(TSO/TI)**(AK/(AK-1.))
	VO=AMO*CSO
	GOTO 9
C ***	OVEREXPANOED, FIND SHOCK POSITION
37	PSX=PIR*(TSO/TI)**(AK/(AK-1.))
	PSY=PSX*(2.*AK*AMO**2/(AK+1.)-(AK- 1.)/(AK+1.))
	IF (PA-PSY) 38, 39, 39
C	OVEREXPANDED, SHOCK OUTSIDE NOZZLE
38	PSO=PSX
	VO=AO*CSO
	GOTO 9
C ***	OVEREXPANDED, SHOCK INSIDE NOZZLE
39	PSO=PA
	J=0
	TSO=0.833*TI
40	J=J+1
	CALL PROCOM (FAR, TSO, CSO, AK, CP, REX, PHISO, HSO)
	RHO=CAPSF*PSO/(AJ*REX*TSO)
	VO=WG/(RHO*AO)
	HSCAL=HI-VO**2/(2.*G*AJ)
	DELHS=HSCAL-HSO
	IF (ABS(DELHS)-0.0001*HSCAL) 42, 42, 41
41	TS=TSO+DELHS/CP
	IF (J-15) 40, 40, 3
42	AMO=VO/CSO
	TO=TI
	HO=HI
	PO=PSO*(TO/TSO)**(AK/(AK-1.))
	SO=PHII-REX*ALOG(PO)
	ICON=2
	GOTO 10
	END

