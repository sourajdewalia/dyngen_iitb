	SUBROUTINE COHPTB
C
C	uses BLOCK DATA to perform inner-turbine calculations (not used in
C	engine configurations c and g)
C
	COMMON  /WORDS/ WORD
	COMMON  /DESIGN/
     1	IDES,	JOES,	KDES,	MODE,	INIT,	IDUMP,	IAMTP,	IGASMX,
     2	IDBURN,	IAFTBN,	IDCD,	IMCO,	IDSHOC,	IMSHOC,	NOZFLT,	ITRYS,
     3	LOOPER,	NOMAP,	NUNMAP,	MAPEDG,	TOLALL,	ERR(9)

       COMMON /ALL1/
     1	PCNFGU,	PCNCGU,	T4GU,	DUMOI,	DUND2,	DELFG,	DELFN,	DELSFC,
     2	ZFDS,	PCNFDS,	PRFDS,	ETAFDS,	WAFDS,	PRFCF,	ETAFCF,	WAFCF,
     3	ZCDS,	PCNCDS,	PRCDS,	ETACDS,	WACDS,	PRCCF,	ETACCF,	WACCF,
     4	TCDS,	WFBDS,	DTCOOS,	ETABDS,	WA3CDS,	DPCOOS,	OTCOCF,	ETAECF,
     5	TFHPOS,	CNHPDS,	ETHPDS,	TFHPCF,	CNHPCF,	ETHPCF,	DHHPCF,	T2DS,
     6	TFLPDS,	CNLPOS,	ETLPDS,	TFLPCF,	CNLPCF,	ETLPCF,	DHLPCF,	T21DS,
     7	T24OS,	WFODS,	DTDUDS,	ETADDS,	WA23DS,	DPDUDS,	DTDUCF,	ETADCF,
     8	T7DS	WFAOS,	DTAFDS,	ETAADS,	WG6CDS,	OPAFDS,	DTAFCF,	ETAACF,
     9	A55,	A25,	AG,	AT,	AB,	A9,	A28,	WA29,
     $	PS55,	AW55,	CVONOZ,	CVMNOZ,	ADSAV,	AgSAV,	A28SAV,	A29SAV

	COMMON /ALL2/
     1	T1,	PL,	H1,	S1,	T2,	P2,	H2,	S2,
     2	T21,	P21,	H21,	S21,	T3,	P3,	H3,	S3,
     3	T4,	P4,	H4,	S4,	T5,	P5,	H5,	S5,
     4	T55,	P55,	H55,	S55,	BLF,	BLC,	BLDU,	BLOB,
     5	CNF,	PRF,	ETAF,	WAFC,	WAF,	WA3,	WG4,	FAR4,
     6	CNC,	PRC,	ETAC,	WACC,	WAC,	ETAB,	DPCOM,	DUMP,
     7	CNHP,	ETATHP,	OHTCHP,	DHTC,	BLHP,	WG5,	FAR5,	CS,
     8	CNLP,	ETATLP,	DHTCLP,	DHTF,	BLLP,	WGS5,	FARSS,	HPEXT,
     9	AM,	ALTP,	ETAR,	ZF,	PCNF,	ZC,	PCNC,	WFB,
     $	TFFHP,	TFFLP,	PCBLF,	PCBLC,	PCBLDU,	PCBLOB,	PCBLHP,	PCBLLP

	COMMON  /ALL3/
     1	XP1,	XWAF,	XWAC,	XBLF,	XBLDU,	XH3,	DUMSI,	OUMS2,
     2	XT21,	XP21,	XH21,	XS21,	T23,	P23,	H23,	S23,
     3	T24,	P24,	H24,	S24,	T25,	P25,	H25,	S25,
     4	T28,	P28,	H28,	S28,	T29,	P29,	H29,	S29,
     5	WAD,	WFD,	WG24,	FAR24,	ETAD,	DPDUC,	BYPASS,	DUMS3,
     6	TS28,	PS28,	V28,	AM28,	TS29,	PS29,	V29,	AM29,
     7	XT55,	XP55,	XH55,	XS55,	XT25,	XP25,	XH25,	XS25,
     8	XWFB,	XWG55,	XFAR55,	XWFD,	XMG24,	XFAR24,	XXP1,	DUM8,
     9	T6,	P6,	H6,	S6,	T7,	P7,	H7,	S7,
     $	T8,	P8,	H8,	S8,	T9,	P9,	H9,	S9

	COMMON	/ALL4/
     1	WG6,	WFA,	WG7,	FAR7,	ETAA,	DPAFT,	V55,	V25,
     2	PS6,	V6,	AM6,	TS7,	PS7,	V7,	AM7,	AM25,
     3	TS8,	PS8,	V8,	AM8,	TS9,	PS9,	V9,	AM9,
     4	VA,	FRD,	VJD,	FGMD,	VJM,	FGMM,	FGPD,	FGPN,
     5	FGM,	FGP,	WFT,	MGT,	FART,	FG,	FN,	SFC,
     6	WA32,	OPWGDS,	DPWING,	WA32DS,	A38,	AM38,	V38,	T38,
     7	H38,	P38,	S38,	PS38,	T39,	H39,	P39,	TS39,
     8	V39,	AM39,	A39,	BPRINT,	WG37,	CVDWNG,	FGMWNG,	FGPWNG,
     9	FNWING,	FNNAIN,	FWOVFN,	PS39,	FFOVFN,	FCOVFN,	FMNOFN,	FNOVFO,
     $	VJW,	T22,	P22,	H22,	S22,	T50,	PS0,	HS0

	COMMON	/ALL5/
     1	S50,	WA22,	ZI,	PCN,	CNI,	PRI,	ETAI,	WACI,
     2	TFFP,	CNIP,	ETATIP,	DHTCIP,	DHTI,	BLIP,	PCBLIC,PCNIGU,
     3	ZIDS,	PCNIDS,	PRIDS,	ETAIDS,	WAEDS,	PRICF,	ETAICF,	MAICF
     4	TFIPDS,	CNIPDS,	ETIPDS,	TFIPCF,	CNIPCF,	ETIPCF,	DHIPCF,	WAICDS,
     5  WAI,	 PCBLI,	BLI,	T22DS,	WA21,	WG50,	FAR50	A24,
     6	AM23,	DUMSPL,	FXFN2H,	FXM2CP,	AFTFAN,	PUNT,	PCBLID,	P6DSAV,
     7	AN6DSV,	ETAASV,	FARTSV,	TGPBL   T41,	FAN,	ISPOol

	COMMON	/RPMS/  XNHPOS,XNIPDS,XNLPDS,PMEHP,PMIIP,PMILP
	COMMON	/VOLS/  VFAN,	VINTC,	VCOMP,	VCOMB,	VHPTRB,
     1	VIPTRB,	VLPTRB,	VAFTBN,	VFDUCT,	VMDUCT

	COMMON 	/FLOWS/	WAFP,WAIP,WACP

	COMMON	/UNITS/	SI

	LOGICAL	SI

	DIMENSION Q(9)

	LOGICAL	FXFN2N,	FXM2CP,	DUMSPL

	COMMON	/HTURB/	TFFX(15), CNX(15,15), DHTCX(15,15),ETATX(15,5),
     1	NTFFS, NPTTFF(15)

	DATA	AWORD, WLO, WHI/ 6HCOHPTB, 6H  (LO), 6H  (LO)/
	WORD=AWORD
	IF(SI) GOTO 100
	RA=0.0252
	AJ=2.719
	CONFAC=1.4091E-5
	GOTO 101
100     RA=286.9
	AJ=1.0
	CONFAC=1.0966E-2
101	CONTINUE

	IF (SPOOL.EQ.1) GOTO 8
	IF (IDES.EQ.0) GOTO 1
	CNHPCF=CNHPDS*SQRT(T41)/PCNC
1	CNHP=CNHPCF*PCNC/SQRT(T4)
	CNHPS=CNHP
	TFFHPS=TFFHP

	CALL	SEARCH (-1., TFFHP,CNHP,DHTCHP,ETATHP,TFFX(1), NTFFS,
     1	CNX(1,1), DHTCX(1,1),ETATX(1,1), NPTTFF(1),15,15,IGO)

	IF (IGO.EQ.1.OR.IGO.EQ.11.OR.IGO.EQ.21) WRITE (18,9)TFFHPS,WLO
	IF (IGO.EQ.2.OR.IGO.EQ.12.OR.IGO.EQ.22) WRITE (8,9) TFFHPS,WHI
	IF (IGO.EQ.10.OR.IGO.EQ.11.OR.IGO.EQ.12) WRITE (8,10) CNHPS,WLO
	IF (GO.EQ.20.OR.IGO.EQ.21.OR.IGO.EQ.22) WRITE    (8,10) CNHPS,WHI

	IF (IGO.NE.7) GOTO 2
	CALL  ERROR
	RETURN

2	NOMAP=0
	TFHCAL=WG4*SQRT(T4)/(14.696*P4)
	BTUEXT=0.706705*HPEXT
	IF(SI) TFHCAL=WG4*SQRT(T4)/P4
	IF(SI) BTUEXT=HPEXT
	XNHP=XNHPDS*PCNC/100.
	XNHDOT=DERIV(1,XNHP)
	DHTCC=(BTUEXT*WACP*(H3-H21)*CONFAC*PHIHP*XNHP*XNHDOT)/(WG4*T4)
	IF (IDES.EQ.0) GOTO 5
	TFHPCF=TFHPDS/TFHCAL
	DHHPCF=DHTCC/DHTCHP
	ETHPCF=ETHPDS/ETATHP

	WRITE (4,11) CNHPCF,TFHPCF,ETHPCF,OHHPCF
5	TFHCAL=TFHPCF*TFHCAL
	DHTCHP=DHHPCF*DHTCHP
	ETATHP=ETHPCF*ETATHP
	DHTC=DHTCC*T4
	ERR(1)=(TFHCAL-TFFHP)/TFHCAL
	ERR(2)=(OHTCC-DHTCHP)/OHTCC

	CALL THTURB (DHTC,ETATH, FAR4, H4,S4,P4,T50,H50,S50,P50)
	IF (BLHP.LE.0.0)  GOTO 6
	FAR50=FAR4*WG4/(WG4*BLHP*(FAR4+1.))
	WG50=WG4+BLHP
	H50=(BLHP*H3*WG4*H50)/WG50
	CALL THERMO(P50,H50,T50,S50,XX2,1,FAR60,1)
	GOTO 7

6	FAR50=FAR4
	WG50=WG4
7	CONTINUE

	IF(VHPTRB.EQ.0.0) GOTO 21
	Q(2)=0.0
	Q(3)=0.0
	WG50P=WG50
	H60P=H50
	P50DOT=DERIV(12,P50)
18	CONTINUE

	CALL THERMO (P50,H50,T50,S50,XX2,1,FAR50,0)
	WG50= WG50P-P50DOT*VHPTRB/T50/1.4/RA
	U50=H50-RA*AJ*T50
	U50DOT=DERIV(13,U50)
	H50X=(WG50P*H50P-(WG50P-WG50)*U50-U60DOT*P50*VHPTRB/T50/RA)/WG50
	ERRW=(H50-H50X)/H50
	DIR=SQRT(ABS(H50/H50X))
	CALL AFQUIR(Q(1),T50,ERRW,0.,20.,0.0001, DIR,T5OT,IGO)
	GOTO (19,21,20),IGO
19	T50=T50T
	GOTO 18
20	CALL ERROR
21	CONTINUE
	IF(FXFN2N.OR.DUMSPL) GOTO 8
	CALL  COIPTB
	RETURN
8	P5=P50
	H5=H50
	TB=TBO
	S5=S50
	FAR5=FAR50
	WG5=WG50
C	SET MIDDLE TURBINE PARAMETERS TO ZERO, NOT USED
	TFFIP=0.
	CNIP=0.
	DHTI=0.
	DHTCIP=0.
	ETATIP=0
	CALL COLPTB
	RETURN
C
C
C
9	FORMAT (19H0*****TFFHP OFF MAP, F10.4, 2X, A6,11H*****$$$$$$)
10	FORMAT (19H0***** CNHP OFF MAP, F10.4, 2X, A6,11H*****$$$$$$)
11	FORMAT (20HH.P. TURBINE DESIGN , 5X, 7HCNHPCF=,E15.6,
     1	8H TFHPCF=,E15.8, 8H ETHPCF=,E5.8, 8H DHHPCF=, E15.8)

	END


