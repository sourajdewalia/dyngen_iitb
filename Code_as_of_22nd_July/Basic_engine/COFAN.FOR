	SUBROUTINE       COFAN
C
C	COFAN uses Block data to perform fan calculations
C
	COMMON /WORDS/   WORD
	COMMON /DESIGN/
     1	IDES,	JDES,	KDES,	HOOE,	INIT,	IDUMP,	IANTP,	IGASHX,
     2	IDBURN,	IAFTBN,	IDCD,	IMCD,	IOSHOC,	IMSHOC,	NOZFLT,	ITRYS,
     3	LOOPER,	NOMAP,	NUNMAP,	MAPEDG,	TOLALL,	ERR(9)

	COMMON	/ALL1/
     1  PCNFGU,	PCNCGU,	T4GU,	DUMD1,	DUMP2,	DELFG,	DELFN,	DELSFC,
     2   ZFOS,	PCMFDS,	PRFDS,	ETAFDS,	wAFDS,	PRFCF,	ETAFCF,	WAFCF,
     3	ZCDS,	PCNCDS,	PRCOS,	ETACDS,	CDS,	PRCCF,	ETACCF,	HACCF,
     4	T60S,	WFBDS,	DTCOOS,	ETABDS,	WA3CDS,	DPCDDS,	DTCOCF,	ETABCF,
     5	TFHPDS,	CNHPDS,	ETHPOS,	TFHPCF,	CNHPCF,	ETHPCF,	DHHPCF,	TZOS,
     6	TFLPDS,	CNLPOS,	ETLPOS,	TFLPCF,	CNLPCF,	ETLPCF,	DHLPCF,	T21DS,
     7	T26DS,	HFDOS,	DTDUOS,	ETAODS,	AZ3DS,	DPOUOS,	DTDUCF,	ETADCF,
     8	TTDS,	WFAOS	DTAFDS,	ETAADS,	G6CDS,	DPAFOS,	OTAFCF,	ETAACF,
     9	A55,	A25,	A6,	A7,	A8,	A9,	A28,	A29,
     $	SPSSS,	AMSS,	CVDNOZ,	CVMNOZ,	ABSAV,	SAV  ,A2BSAV,	A29SAV

	COMMON	/ALL2/
     1  T1,	P1,	H1,	S1,	T2,	P2,	H2,	S2,
     2	T21,	P21,	H21,	S21,	T3,	P3,	H3,	S3,
     3	T4,	P4,	H4,	S4,	T5,	P5,	H5,	S5,
     4	T55,	P55,	H55,	S55,	BLF,	BLC,	BLOU,	BLOB,
     5	CNF,	PRF,	ETAF,	WAFC,	WAF,	A3,	G6,	FAR6,
     6	CNC,	PRC,	ETAC,	ACC,	WAC,	ETAB,	DPCOH,	DUMP,
     7	CNHP,	ETATHP,	DHTCHP,	DHTC,	BLHP,	WG5,	FAR5,	CS,
     8	CNLP,	ETATLP,	DHTCLP,	DHTF,	BLLP,	WG55,	FAR55,	HPEXT,
     9	AM,	ALTP,	ETAR,	ZF,	PCNF,	ZC,	PCHC,	FB,
     $	TFFHP,	TFFLP,	PCBLF,	PCBLC,	PCBLDU,	PCBLOB,	PCBLHP,	PCBLLP

	COMMON	/ALL3/
     1	XP1,	XWAF,	XWAC,	XBLF,	XBLDU,	XH3,	DUMs1,	DUMS2,
     2	XT21,	XP21,	XH21,	XS21,	T23,	P23,	H23,	S23,
     3	T24,	P26,	H26,	S26,	T25,	P25,	H25,	S25,
     4	T28,	P28,	H28,	S28,	T29,	P29,	H29,	S29,
     5	SWAD,	WFD,	WG24,	FAR24,	ETAD,	DPDUC,	BYPASS,	DUMS3,
     6	TS28,	PS28,	V28,	AN28,	TS29,	PS29,	V29,	AM29,
     7	XT55,	XP55,	XH55,	XS55,	XT25,	XP25,	XH25,	XS25,
     8	XMFB,	XWG55,	XFAR55,	XMFD,	XWG24,	XFAR24,	XXP1,	DUMB,
     9	T6,	P6,	H6,	S6,	T7,	P7,	H7,	S7,
     $	T8,	P8,	H8,	S8,	T9,	P9,	H9,	S9

	COMMON	/ALL4/
     1	WG6,	WFA,	WG7,	FAR7,	ETAA,	DPAFT,	V55,	V25,
     2	PS6,	V6,	AM6,	TS7,	PS7,	VT,	AM7,	AM25,
     3	TS8,	PS8,	V8,	AM8,	TS9,	PS9,	V9,	AM9,
     4	VA,	FRD,	VJD,	FGMD,	VJM,	FGMM,	FGPD,	FGPM,
     5	FGM,	FGP,	WFT,	WGT,	FART,	FG,	FN,	SFC,
     6	WA32,	OPWGDS,	DPWING,	WA32OS,	A38,	AM38,	V38,	T38,
     7	H38,	P38,	TS38,	PS38,	T39,	H39,	P39,	TS39,
     8	V39,	AM39,	A39,	BPRINT,	WG37,	CVDMNG,	FGNWNG,	FGPWNG,
     9	FNMING,	FNMAIN,	FMOVFN,	PS39,	FFOVFN,	FCOVFN,	FMNOFN,	FNOVFD,
     $	VJW,	T22,	P22,	H22,	S22,	T5O,	PSO,	HSO

	COMMON	/ALL5/
     1	S5O,	WA22,	ZI,	PCNI,	CNI,	PRI,	ETAI,	WACI,
     2	TFFIP,	CNIP,	ETATIP,	DHTCIP,	OHT,	BLIP,	PCBLIP,	PCNIGU,
     3	ZIDS,	PCNIDS,	PRIDS,	ETAIDS,	MAIDS,	PRICF,	ETAICF,	MAICF,
     4	TFIPDS,	CNIPDS,	ETIPDS,	TFIPCF,	CNIPCF,	ETIPCF,	DHIPCF,	WAICDS,
     5	WAI,	PCBLI,	BLI,	T22DS,	WA21,	WGSO,	FARSO,	A26,
     6	AM23,	DUMSPL,	FXFN2M,	FXM2CP,	AFTFAN,	PUNT,	PCBLIO,	P6OSAV,
     7	AM6OSV,	ETAASV,	FAR75V,	T4PBL,	T41,	FAN,	ISPOOL

	COMMON	/DYN/ TRAN, TIME, DT, TF, JTRAN, NSTEP,	TPRINT,DTPRNT

	COMMON	/VOLS/ VFAN, VINTC, VCOMP, VCOMB, VHPTRB, VIPTRB,
     1	VLPTRB, VAFTBN, VFDUCT, VMDUCT

	COMMON	/FLOWS/  WAFP,WAIP,MACP

	COMMON /UNITS/ SI

	LOGICAL	SI

	LOGICAL	FXM2CP

	COMMON /FAN/ CNX(15), PRX(15,15),WACX(15,15),ETAX(15,15),
     1	NCN, NPT(15)

	DIMENSION  Q(9), WLH(2)

	DATA AWORD, WLH /6H COFAN, 6H (LO) ,6H (HI) /
	WORD = AWORD

	IF (SI) GOTO 100
	TSTO=518.668
	PSTD=1.0
	RA=.0252
	AJ=2.179
	GOTO 101
100	TSTO=288.149
	PSTD=101325.
	RA=286.9
	AJ=1.0
101	THETA=SQRT(T2/TSTD)
	DELTA=P2/PSTD
	IF (IDES.NE.1) GOTO 1
	THETAD=THETA
	WAFDS=AFC*DELTA/THETA
1	CNF=PCNF*THETAD/(100**THETA)
	IF (ZF.LT.0.1) ZF=0.
	IF (ZF.GT.1.) ZF=1.
	CNFS=CNF
	CALL SEARCH (ZF, CNF, PRF, NAFC, ETAF, CNX(1), NCN, PRX(1,1),
     1	WACX(1,1),ETAX(1,1), NPT(1), 15,15,IGO)
	IF ((CNF-CNFS).GT.0.0005*CNF) MAPEDG=1
	IF (IGO.EQ.1.OR.IGO.EQ.2)  WRITE (6,12) CNFS,WLH(IGO)
	WAF=WAFC*DELTA/THETA
	IF (IDES.NE.1) GOTO 2
	PRFCF=(PRFDS-1.)/(PRF-1.)
	ETAFCF=ETAFDS/ETAF
	WAFCF=WAFDS/WAF
	WRITE (6,13) PRFCF,ETAFCF,WAFCF,T2OS
2	PRF=PRFCF*(PRF-1.)+1.
	ETAF=ETAFCF*ETAF
	MAFP=WAF
	WAFC=WAFC*WAFCF
       	PCNF= 100.* THETA*CNF/THETAD
	DUMD1=PCNF
	CALL THCOMP (PRF, ETAF,T2,H2,S2,P2,T22,H22,S22,P22)
	IF(VFAN.EQ.0.0) GOTO 21
	Q(2) =0.0
	Q(3) =0
	H22P = H22
	P22DOT=DERIV(4,P22)
18	CONTINUE
	CALL THERMO(P222,H22, T22,S22, XX22, 0.0, 0, 0.0)
	WAF=WAFP-P22DOT*VFAN/T22/1.4/RA
	U22=H22-AJ*RA*T22
	U22DOT=DERIV(5,22)
	H22X=(WAFP*H22P-(WAFP-MAF)*U22-U22DOT*P22*VFAN/T22/RA)/WAF
	ERRW=(H22-H22X)/H22
	DIR=SQRT(ABS(H22/H22X))
	CALL AFQUIR(Q(1), T22, ERRW, 0., 20., 0.0001, DIR, T22T,IGO)
	GOTO (19,21,20), IGO
19	T22=T22T
	GOTO 18
20	CALL ERROR
21	CONTINUE
	IF (PCBLF.GT.0.) BLF=PCBLF*WAF
	IF (JDES.EQ.1) GOTO 9
	JDES=1
	IF (INIT.EQ.1)  GOTO 8
	IF (IDES.EQ.1)  GOTO 6
	IF (JTRAN.EQ.1) GOTO 8
	IF (MOOE.NE.2)  GOTO 3
	T4=GUESS(3,Y1, Y2, PCNF, PCNFDS, NFB,WFBDS, Y7, YB,T4DS)
	PCNI=GUESS(8, T4, T4DS, Y3, Y4, YS, Y6, T22, T22DS, PCNCDS)
	PCNC=GUESS(4,Y1,Y2,PCNI,PCNIDS,WFB,WFBDS,Y7,Y8,PCNCDS)
	GOTO 7
3	IF (MOOE.EQ.1) GOTO 5
	IF (MOOE.EQ.0) GOTO 4
	T4=GUESS(7, Y1, Y2, PCNF, PCNFDS,Y5, Y6,T2, T2DS,T4DS)
4	CONTINUE

	PCNC=GUESS(5, T4, T4DS, Y3, Y4, Y5, Y6, T22, T22DS, PCNIDS)
	IF (FXM2CP) PCNC=PCNCDS**99
	PCNCG1=PCNC
	PCNCG2=PCNCDS
	PCNI=GUESS(9,Y1,Y2,PCNCG1,PCNCG2,Y5,Y6,T22, T22DS, PCNIDS)
	GOTO 7
5	T4=GUESS(6,YI,Y2,PCNC,PCNCDS,Y5,Y6,T22,T22DS,T4OS)
	PCNI=GUESS(8,T4, T4DS,Y3,Y4, YS,Y6,T22,T22DS,PCNIDS)
	GOTO 7
6	PCNC=PCNCDS
	PCNI=PCNC
	T4=T4DS
	WFB=WFBDS
	T21DS=T21
7	ZC=ZCDS
	ZI=ZIDS
	PCNIGU=PCNI
	PCNCGU=PCNC
	T4GU=T4
8	INIT=0
9	IF (MODE.NE.3) GOTO 10
	IF (ABS(CNF-CNFS).LE.0.001*CNFS) GOTO 1
	WRITE (8,14) CNFS,CNF
	CALL ERROR
10	PCNF=100.*THETA*CNF/THETAD
11	CALL COINTC
	RETURN
C
C
12	FORMAT (19H0* * * CNF OFF MAP ,F10.4,2XA6,11H      * *S$)
13    	FORMAT (11H0FAN DESIGN, 13X,8H PRFCF= ,E15.0, 8H ETAFCF=,E15.8,
     1	8HWAFCF=  ,E15.8, 8H T2DS=  , E15.8)
14	FORMAT (10H0CNF WAS= , E15.8,11H AND NOW=  ,E15.8,
     1	24H  CHECK PCNF INPUT$$$$$$)
	END

