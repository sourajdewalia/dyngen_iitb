	SUBROUTINE COAFBN
	COMMON  /WORDS/ WORD

	COMMON  /DESIGN/
     1	IDES, JDES, KDES, MODE, INIT, IDUMP, IAMTP, IGASMX,
     2	IDBURN, IAFTBN, IDCD, IMCD, IDSHOC, IMSHOC, NOZFLT, ITRYS,
     3	LOOPER, NOMAP, NUMMAP, MAPEDG, TOLALL, ERR(9)

	COMMON  /ALL1/
     1	PCNFGU, PCNCGU, T4GU, DUMDL, OUMD2, DELFG, DELFN, DELSFC,
     2  ZFDS, PCNFDS, PRFDS, ETAFDS, WAFDS, PRFCF, ETAFCF, WAFCF,
     3  ZCDS, PCNCDS, PRCDS, ETACDS, WACDS, PRCCF, ETACCF, WACCF,
     4	T4DS, WFBDS, DTCODS, ETABDS, WA3COS, DPCODS, DTCOCF, ETABCF,
     5  TFHPDS, CNHPDS, ETHPDS, TFHPCF, CNHPCF, ETHPCF, DHHPCF, T2DS,
     6	TFLPDSwCNLPDS, ETLPDS, TFLPCF, CNLPCF, ETLPCF, DHLPCF, T2IDS,
     7	T24DS, WFDDS, DTDUDS, ETAODS, WA23DS, DPDUDS, DTDUCF, ETADCF,
     8	T7DS, WFADS, DTAFDS, ETAADSI, G6CDS, DPAFDS, DTAFCF, ETAACF,
     9	A55, A25, A6, A7, A8, A9, A28, A29,
     $	PS55 ,AM55 , CVDNOZ, CVMNOZ, A8SAV, A9SAV, A28SAV, A29SAV

    	COMMON /ALL2/
     1	T1,  P1,  H1,  S1,  T2, P2, H2, S2,
     2	T21, P21, H21, S21, T3, P3, H3, S3,
     3	T4,  P4,  H4,  S4,  T5, P5, H5, S5,
     4	T55, P55, H55, S55, BLF, BLC, BLDU, BLDB,
     5	CNF, PRF, ETAF, WAFC, WAF, WA3, WG4, FAR4,
     6	CNC, PRC, ETAC, WACC, WAC, ETAB, DPCON, DUMP,
     7	CNHP, ETATHP, DHTCHP, DHTC, BLHP, WG5, FAR5, CS,
     8	CNLP, ETATLP, DHTCLP, DHTF, BLLP, WG55, FAR55, HPEXT,
     9	AM, ALTP, ETAR, ZF, PCNF, ZC, PCNC, WFB,
     $	TFFHP, TFFLP, PCBLF, PCBLC, PCBLDU, PCBLOB, PCBLHP, PCBLLP

	COMMON    /ALL3/
     1	XP1, XWAF, XWAC, XBLF, XBLDU, XH3, DUMS1, DUMS2,
     2	XT21, XP21, XH21, XS21, T23, P23, H23, S23,
     3	T24, P24, H24, S24, T25, P25, H25, S25,
     4	T28, P28, H28, S28, T29, P29, H29, S29,
     5	WAD, WFD, WG24, FAR24, ETAD, DPDUC, BYPASS, DUMS3,
     6	TS28, PS28, V28, AM28, TS29, PS29, V29, AM29,
     7	XT55, XP55, XH55, XS55, XT25, XP25, XH25, XS25,
     8	XWFB, XWG55, XFAR55, XMFD, XWG24, XFAR24, XXP1, DUMB,
     9	T6, P6, H6, S6, T7, P7, H7, S7,
     $	T8, P8, H8, S8, T9, P9, H9, S9

	COMMON /ALL4/
     1	WG6, WFA, WG7, FAR7, ETAA, DPAFT, V55, V25
     2	PS6, V6, AM6, TS7, PS7, V7, AM7, AM25,
     3	TS8, PS8, V8, AM8, TS9, PS9, V9, AM9,
     4	VA, FRD, VJD, FGMD, VJM, FGMM, FGPD, FGPM,
     5	FGM, FGP, WFT, WGT, FART, FG, FN, SFC,
     6	WA32, DPWGDS, DPWING, WA32Ds, A38, AM38, V38, T38,
     7	H38, P38, TS38, PS38, T39, H39, P39, TS39,
     8	V39, AM39, A39, BPRINT, WG37, CVDWNG, FGMWNG, FGPWNG,
     9	FNWING, FNMAIN, FWOVFN, PS39, FFOVFN, FCOVFN, FMNOFN, FNOVFD,
     $	VJW, T22, P22, H22, S22, T50, P50, H50

	COMMON /ALL5/
     1	S50, WA22, ZI, PCNI, CNI, PRI, ETAI, WACI,
     2	TFFIP, CNIP, ETATIP, DHTCIP, DHTI, BLIP, PCBLIP, PCNIGU,
     3	ZIDS, PCNIDS, PRIDS, ETAIDS, WAIDS, PRICF, ETAICF, WAICF,
     4	TFIPDS, CNIPDS, ETIPDS, TFIPCF, CNIPCF, ETIPCF, DHIPCF, WAICDS,
     5	WAI, PCBLI, BLI, T22DS, WA21, WG50, FAR50, A24,
     6	AM23, DUMSPL, FXFN2M, FXM2CP, AFTFAN, PUNT, PCBLID, P6DSAV,
     7	AM6DSV, ETAASV, FAR7SV, T4PBL, T41, FAN, ISPOOL

	COMMON /VOLS/ VFAN, VINTC, VCOMP, VHPTRB, VIPTRB, VLPTRB, VAFTBN,
     1	VFDUCT, VWDUCT

	COMMON /UNITS/SI
	LOGICAL SI
	COMMON /WHRERR/ ICOAFB, ICODUC, ICOMIX
	DIMENSION Q(9)
	DATA AWORD/ 6HCOAFBN/
	WORD=AWORD
	Q(2)=0.
	Q(3)=0.
	IF (SI) GO TO 100
	AJ=778.26
	AJX=2.719
	CAPSF=2116.2170
	G=32.174049
	PRATM=14.696
	TDEL=2000.0
	T7MAX=4000.0
	RA=.0252
	GOTO 101

100	AJ=1.0
	AJX=1.0
	CAPSF=101325.0
	G=1.0
	PRATM=14.696/101324.6
	TDEL=1111.0
	TTNAX=2222.0
	RA=286.9
101	CONTINUE
    	COAFB=O

C *** 	P6DS AND AM6DS ARE SET FOR GENERALIZATION OF AFTERBURNER
C *** 	EFFICIENCY MAP GENERALIZATION

	IF (IDES.EQ.1) P6DS=P6*PRATM
	IF (IDES.EQ.1) AM6DS=AM6
	WF6 = FAR55*WG55/(FAR55+1.)
	IF(IGASMX.GT.0) WF6 = WF6 + FAR24*WG24/(FAR24+1.)
	WA6=WG6-WF6

C *** 	DRY LOSS

	WG6C=WG6*SQRT(T6)/P6
	IF (IDES.EQ.1)   WG6CDS=WG6C
	DPAFT=DPAFDS*(WG6C/WG6CDS)
	IF (DPAFT.GT.1.) DPAFT=1.
	P7=P6*(1.-DPAFT)
	A7=A6
	FAR6=WF6/WA6
	CALL PROCOM (FAR6,T6,XXI,XX2,XX3,XX4,PHZ6,XX6)
	WQA=WG6/A7
	C1=P7*SQRT(G/(T6*AJ))*CAPSF
	AM7=AM6
	TS7=0.875*16
1	DO 2 I=1,15
	CALL PROCOM (FAR6,TS7,CS7,AK7,CP7,REX7,PHIS7,HS7)
	V7=AM7*CS7
	HSCAL=H6-V7**2/(2.*G*AJ)
	DELHS=HSCAL-HS7
	IF (ABS(DELHSI).LE.0.0005*HSCAL) GO TO 3
2	TS7=TS7+DELHS/CP7
	ICOAFB=1
	GOTO 14
3	WQAT=C1*SQRT(AK7/REX7)*AM7/(1.+(AK7-1.)*AM7**2/2.)**((AK7+1.)/(2.*
     1	(AK7-1.)))
	DIR=WQA/WQAT
	EW = (WQA-WQAT)/WQA
	CALL AFQUIR (Q(1),AM7,EW,0.,40.,.00,DIR,AM7T,IGO)
	ICOAFB=2
	GOTO (4,5,14), IGO

4	AMT=AM7T
	IF (AMT.GE.1.0) AM7=0.9
	GOTO 1

5	PS7=P7/EXP((PHI6-PHIS7)/REX7)
	IF (IAFTBN.GT.0) GO TO 7

C *** 	NON-AFTERBURNING
6	T7=T6
	WFA=0.0
	FAR7=FAR6
	WGT=WG6
	IF (IDES.EQ.1.AND.T7DS.NE.0.) GO TO 7
	GO TO 20

C *** 	AFTERBURNING
7	IF (IAFTBN.EQ.2) T7=T6+TDEL
	IF (IDES.EQ.1) T7=T7DS
	IF (T7.LE.T6) GO TO 6
	RHO65=CAPSF*PS7/(AJ*REX7*TS7)
	PS6S=PS7
	V65=V7
	Q(2)=0.
	Q(3)=0.
8	IF (T7.GT.T7MAX) T7=T7MAX
	IF (T7.LT.T6) T7=T6*1.001
	IF (SI) T7=T7*9.0/5.0
	HV=((((((-.4594317E-19*T7)-.2034116E-15)*T7+.2783643E-11)*T7+.2051
     1	501E-07)*T7-.2453116E-03)*T7-.9433296E-01)*T7+.1845537E+05
	IF (SI) T7=T7*5.0/9.0
	IF (SI) HV=HV*2325.4295
	CALL THERMO (P7,HA,T7,XX1,XX2,1,FAR6,0)

C *** TO ALTER DESIGN ABETAA MAP FROM GENERAL TO SPECIFIC MAP

	IF (IDES.NE.1) GOTO 9
	FAR7DS=(HA-H6)/(HV*ETAADS)
	CALL ETAAB (0.,0.,0.,0.,ETAADS,ETAASV,P6DS,P6DSAV,AM6DS,AM6DSV,
     1	IDES,FAR7DS,FAR7SV)
	T7=T6
	GOTO 20
9	P6GS=P6*PRATM
	FAR7GS=(HA-H6)/(HV*ETAADS)
	DO 10 II=1,15
	CALL ETAAB (FAR7GS,AM6,P6GS,ETAA,ETAADS,ETAASV,P6DS,P6DSAV,AM6DS,
     1	AM6DSV, IDES, FAR7DS, FAR7SV)
	FAR7=(HA-H6)/(HV*ETAA)
	DELFA7=ABS(FAR7-FAR7GS)
	IF (DELFA7.LE.0.01*FAR7) GOTO 11
10	FAR7GS =FAR7
11	CONTINUE
	IF (FART.GT.0.) GOTO 12
	ICDAFB=3
	CALL ERROR
12	WFAX=FAR7*WG6
	IF (AFTBN.EQ.1) GOTO 15
	ERRW=(WFA-WFAX)/WFA
	DIR=SQRT(WFA/WFAX)
	CALL AFQUIR (Q(1),T7,ERRW,0.,30.,.0005,DIR,T7T,IGO)
	ICOAFB=4
	GOTO (13,16,14), IGO

13	T7=T7T
	GOTO 8
14	CALL ERROR
15	WFA=WFAX
16	FART=(WF6+WFA)/WA6
	WG7=WG6+WFA

C *** 	MOMENTUM  LOSS
	CALL PROCOM (FAR7,T7,XX1,XX2,XX3,REX7,PHI7,H7)
	RHO7=CAPSF*P7/(AJ*REX7*T7)
	V7=WG7/(RHO7*A7)
	Q(2)=0.
	Q(3)=0.
	PS7=PS65-0.01
17	RHO7=WG7/(V7*A7)
	HS7=H7-V7**2/(2.*G*AJ)
	CALL THERMO (1.0,HS7,TS7,PHIS7,XX2,1,FAR7,1)
	IF (TS7.GE.301.) GO TO 18
	CALL THERMO (1.0,HS7,400.,PHIS7,XX2,1,FAR7,0)
	V7=SQRT(2.*G*AJ*(H7-HS7))
	GO TO 17

18	PS7=RHO7*AJ*REX7*TS7/CAPSF
	PS7A=PS65+(RHO65*V65**2-RHO7*V7**2)/(G*CAPSF)
	DIR=SQRT(ABS(PS7/PS7A))
	EP=(PS7-PS7A)/PS7
	CALL AFQUIR (Q(1),V7,EP,0.,50.,.001,DIR,V7T,IGO)
	V7=V7T
	IF (V7.LT.100.) V2=100.
	ICOAFB=5
	GOTO (17,19,14), IGO

19	P7=PS7*EXP((PH7-PHIS7)/REX7)
	CALL PROCOM (FAR7,TS7,CS7,XX2,XX3,XX6,XX5,XX6)
	AHT=VT/CS7
20	CALL THERMO (P7,H7,T7,S7,XX2,1,FAR7,0)
	IF (VAFTBN.EQ.0.0) GO TO 31
	Q(2)=0.0
	Q(3)=0.0
	WG7P=MG7
	H7P=H7
	P7DOT=DERIV(18,P7)
28	CONTINUE
	CALL THERMO (P7,H7,T7,S7,XX2,1,FAR7,0)
	HG7=HG7P-P7DOT*VAFTBN/T7/(1.4*RA)
	U7=H7-AJX*RA*T7
	U7DOT=DERIV(19,U7)
	H7X=(WG7P*H7P-(WG7P-WG7)*U7-U7DOT*P7*VAFTBN/T7/RA)/WG7
	ERRW=(H7-H7X)/H7
	DIR=SQRT(ABS(H7/H7X))
	CALL AFQUIR (Q(1),T7,ERRW,0.,20.,0.0001,DIR,T7T,IGO)
	ICOAFB=6
	GOTO (29,31,30), IGO
29	T7=T7T
	GOTO 28
30	CALL ERROR
31	CONTINUE
	ICOAFB=O
	CALL COMNOZ
	RETURN
C
C
	END
